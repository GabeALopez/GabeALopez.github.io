<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D}</style><title>Automation Mindset - Technical Details</title><meta name=description content="Foreword As a brief disclaimer, I want to make it clear that I do not consider myself an expert or advanced scripter, and that is completely acceptable. It is …"><meta name=keywords content="blog,gokarna,hugo,Cybersecurity,Automation"><meta property="og:url" content="https://gabealopez.github.io/posts/automation-mindset-technical-details/"><meta property="og:type" content="website"><meta property="og:title" content="Automation Mindset - Technical Details"><meta property="og:description" content="Foreword As a brief disclaimer, I want to make it clear that I do not consider myself an expert or advanced scripter, and that is completely acceptable. It is …"><meta property="og:image" content="https://gabealopez.github.io/cyberduck"><meta property="og:image:secure_url" content="https://gabealopez.github.io/cyberduck"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Automation Mindset - Technical Details"><meta name=twitter:description content="Foreword As a brief disclaimer, I want to make it clear that I do not consider myself an expert or advanced scripter, and that is completely acceptable. It is …"><meta property="twitter:domain" content="https://gabealopez.github.io/posts/automation-mindset-technical-details/"><meta property="twitter:url" content="https://gabealopez.github.io/posts/automation-mindset-technical-details/"><meta name=twitter:image content="https://gabealopez.github.io/cyberduck"><link rel=canonical href=https://gabealopez.github.io/posts/automation-mindset-technical-details/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.05408f4b6e97f753bafd29ac283c6886192dc1e928f4ae7468522f6796a0f2a1.js integrity="sha256-BUCPS26X91O6/SmsKDxohhktweko9K50aFIvZ5ag8qE="></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css integrity=sha384-Xi8rHCmBmhbuyyhbI88391ZKP2dmfnOl4rT9ZfRI7mLTdk1wblIUnrIq35nqwEvC crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js integrity=sha384-X/XCfMm41VSsqRNQgDerQczD69XqmjOOOwYQvr/uuC+j4OPoNhVgjdGFwhvN02Ja crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],throwOnError:!1})})</script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://gabealopez.github.io/><img src=/cyberduck alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://gabealopez.github.io/>Gabriel Lopez</a></div><div class=nav-links><div class=nav-link><a href=https://gabealopez.github.io/ aria-label><span data-feather=home></span> Home</a></div><div class=nav-link><a href=https://gabealopez.github.io/posts/ aria-label><span data-feather=book></span> Posts</a></div><div class=nav-link><a href=https://gabealopez.github.io/projects/ aria-label><span data-feather=code></span> Projects</a></div><div class=nav-link><a href=https://gabealopez.github.io/tags/ aria-label><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://github.com/GabeALopez aria-label=github><span data-feather=github></span></a></div><div class=nav-link><a href=https://gabealopez.github.io/index.xml aria-label=rss><span data-feather=rss></span></a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://gabealopez.github.io/><span data-feather=home></span> Home</a></li><li class=nav-item><a href=https://gabealopez.github.io/posts/><span data-feather=book></span> Posts</a></li><li class=nav-item><a href=https://gabealopez.github.io/projects/><span data-feather=code></span> Projects</a></li><li class=nav-item><a href=https://gabealopez.github.io/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://github.com/GabeALopez><span data-feather=github></span></a></li><li class=nav-item><a href=https://gabealopez.github.io/index.xml><span data-feather=rss></span></a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>Automation Mindset - Technical Details</h1><small role=doc-subtitle></small><p class=post-date>2025-07-05</p><ul class=post-tags><li class=post-tag><a href=https://gabealopez.github.io/tags/cybersecurity>Cybersecurity</a></li><li class=post-tag><a href=https://gabealopez.github.io/tags/automation>Automation</a></li></ul></div><div class=post-content><h1 id=foreword>Foreword</h1><p>As a brief disclaimer, I want to make it clear that I do not consider myself an expert or advanced scripter, and that is completely acceptable. It is important to understand that not all code is perfect on the first attempt, and the code I will be discussing here is no exception.</p><p>This was my first serious attempt at automating a task within a real enterprise environment, so the code is far from optimal.</p><p>In the world of scripting, functionality often takes precedence. Optimization typically becomes a priority only when the code becomes noticeably slow or difficult to work with.</p><p>Of course, this reflects my personal perspective. You are welcome to interpret it as you see fit.</p><p>But without a further adieu, let&rsquo;s jump into the start of technical details.</p><hr><p>As mentioned in the first automation post, it is important to understand what data you want and how to get it.</p><p>When I was automating risky user data, I needed to find a way to grab the azure data for a user. I had used the API explorer that is in O365 (aka Defender), which could run KQL statements.</p><p>So the KQL statement I used in to send to the API looked like this:</p><pre tabindex=0><code class=language-kql data-lang=kql>let created_date_time = IdentityInfo
| where AccountUpn contains &#39;account_upn&#39;
| project CreatedDateTime, AccountUpn;
AADSignInEventsBeta 
| join kind=innerunique created_date_time on AccountUpn
| take 1 
| project CreatedDateTime, LastPasswordChangeTimestamp
</code></pre><hr><p>Let&rsquo;s walk through the code starting with the first three lines:</p><pre tabindex=0><code class=language-kql data-lang=kql>let created_date_time = IdentityInfo
| where AccountUpn contains &#39;account_upn&#39;
| project CreatedDateTime, AccountUpn;
</code></pre><p>In KQL, the keyword <strong>let</strong> signal usage of a variable. So in this instance, entire query after the &ldquo;=&rdquo; character and before the &ldquo;;&rdquo; character is saved into the variable called &ldquo;created_data_time&rdquo;</p><p>This is helpful if we want to make the rest of the query look less cluttered.</p><p>The next line is saying that in the IdentityInfo, show be results where the values in the AccountUpn column contain &ldquo;account_upn&rdquo;, where account_upn is the user principal name you are looking</p><p>In our case, it will be a user email. So <code>bob.evans@example.com</code> would be an example of the principal name we are looking for.</p><p>In the final line, it says that for every entry only show the CreatedDateTime and AccountUpn columns.</p><p>This is so that less data has to be displayed and making the query run a little faster.</p><p>Once all of that query is ran, it is saved into the var to be used in the next part of the query</p><p>So at this point, we have the Date/Time of Bob Evans&rsquo;s account and the UPN, which will bused in the next part of the query</p><hr><pre tabindex=0><code class=language-kql data-lang=kql>AADSignInEventsBeta 
| join kind=innerunique created_date_time on AccountUpn
| take 1 
| project CreatedDateTime, LastPasswordChangeTimestamp
</code></pre><p>Now, in the next part, we are going to query the AADSignInEventsBeta table, which contains information about user&rsquo;s SignIn logs but also some other metadata on the user&rsquo;s account</p><p>In the next line, we are going to join the data from the &ldquo;created_date_time&rdquo; query (or table) with the current AADSignInEventsBeta table on the AccountUpn. The query is using an innerunique join.</p><p>To get a visual of what this looks like, you can see the visual at the official Microsoft (MS) documentation <a href="https://learn.microsoft.com/en-us/kusto/query/join-operator?view=microsoft-fabric">here</a></p><p>The two circles, in the visual represent tables and the data were joining on is the middle of the two circles</p><p>So in our case, the only SignIn logs (or more precisely table entires) that are going to be shown are those with the <code>bob.evans@example.com</code> in the AccountUpn column.</p><p>From here, we are going to only take the first entry the pops up. After that we are only going to show the CreatedDateTime and LastPasswordChangeTimestamp columns for the user.</p><p>So in summary, when we input a user email we are going to get the Date/time of when the user&rsquo;s account was created and the timestamp of when the user changed their password last as output.</p><p>It is a bit of a long one but I hope the KQL makes sense. Also have to stick with me, because we haven&rsquo;t gotten to the API part of this.</p><hr><p>But before that I want to answer a question someone might have.</p><p>How did I figure out what data were in these tables and, by extension, columns? And how did I figure out which keywords to use?</p><p>Starting with the keywords, I have a background in some SQL from some database projects I have done in the past. So kql was very similar in syntax to it and did a trial and error of was the same and what wasn&rsquo;t.</p><p>But for those who don&rsquo;t have the background it is going to be a little harder of course.</p><p>Two good things you can do is read documentation and following examples, watching input and output.</p><p>For documentation, I am not saying to read the entire thing but read the &ldquo;Get started&rdquo; guide so you can follow how to run and write queries.</p><p>At the end of the day, documentation is meant to be referenced not read.</p><p>Secondly, look into many examples. Look at how they run in your own environment. Also make sure to break apart your queries.</p><p>Run each line one by one added together so you can understand logic of the query.</p><p>With figuring out the tables and columns I needed to use, I had done trial and error. I had looked through the available tables I had and just ran the tables by themselves, which gives a lot of data.</p><p>I had just combed through the columns and tried to understand what data was being given to me. So for example, when I was rummaging around in the AADSignInEventsBeta table I had found that it had a AccountUpn column and a LastPasswordChangeTimestamp column.</p><p>This was interesting as this table had the AccountUpn which matched up with another AccountUpn column in the IdentityInfo table. So I thought, what if I joined them on that column.</p><p>Additionally, the IdentityInfo column was missing the LastPasswordChangeTimestamp column but did have the CreatedDateTime which was not present in the AADSignInEventsBeta. So what if I combined them together and only showed the necessary columns? And that&rsquo;s what I did</p><p>There are also keywords like: getschema that will get you the schema of the table so you can more easily understand what is in it skeleton-wise</p><p>But I prefer just taking the first few rows and looking at how the data is presented.</p><hr><p>With that out of the way, it&rsquo;s now really time to talk about the code.</p><p>Which I&rsquo;ll come back to when I finish writing up this post.</p><hr><hr><h1 id=under-construction>Under Construction</h1><hr></div><div class=prev-next></div><svg id="btt-button" class="arrow-logo" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg><script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script></div></main><footer class=footer><span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer></body></html>