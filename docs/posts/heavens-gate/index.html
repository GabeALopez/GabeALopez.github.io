<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D}</style><title>Heavens Gate</title><meta name=description content="When Microsoft introduced 64-bit Windows, backward compatibility for 32-bit applications remained essential. This compatibility layer, called WOW64 …"><meta name=keywords content="blog,gokarna,hugo,Cybersecurity,Malware"><meta property="og:url" content="https://gabealopez.github.io/posts/heavens-gate/"><meta property="og:type" content="website"><meta property="og:title" content="Heavens Gate"><meta property="og:description" content="When Microsoft introduced 64-bit Windows, backward compatibility for 32-bit applications remained essential. This compatibility layer, called WOW64 …"><meta property="og:image" content="https://gabealopez.github.io/cyberduck"><meta property="og:image:secure_url" content="https://gabealopez.github.io/cyberduck"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Heavens Gate"><meta name=twitter:description content="When Microsoft introduced 64-bit Windows, backward compatibility for 32-bit applications remained essential. This compatibility layer, called WOW64 …"><meta property="twitter:domain" content="https://gabealopez.github.io/posts/heavens-gate/"><meta property="twitter:url" content="https://gabealopez.github.io/posts/heavens-gate/"><meta name=twitter:image content="https://gabealopez.github.io/cyberduck"><link rel=canonical href=https://gabealopez.github.io/posts/heavens-gate/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.05408f4b6e97f753bafd29ac283c6886192dc1e928f4ae7468522f6796a0f2a1.js integrity="sha256-BUCPS26X91O6/SmsKDxohhktweko9K50aFIvZ5ag8qE="></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css integrity=sha384-Xi8rHCmBmhbuyyhbI88391ZKP2dmfnOl4rT9ZfRI7mLTdk1wblIUnrIq35nqwEvC crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js integrity=sha384-X/XCfMm41VSsqRNQgDerQczD69XqmjOOOwYQvr/uuC+j4OPoNhVgjdGFwhvN02Ja crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],throwOnError:!1})})</script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://gabealopez.github.io/><img src=/cyberduck alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://gabealopez.github.io/>Gabriel Lopez</a></div><div class=nav-links><div class=nav-link><a href=https://gabealopez.github.io/ aria-label><span data-feather=home></span> Home</a></div><div class=nav-link><a href=https://gabealopez.github.io/posts/ aria-label><span data-feather=book></span> Posts</a></div><div class=nav-link><a href=https://gabealopez.github.io/projects/ aria-label><span data-feather=code></span> Projects</a></div><div class=nav-link><a href=https://gabealopez.github.io/tags/ aria-label><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://github.com/GabeALopez aria-label=github><span data-feather=github></span></a></div><div class=nav-link><a href=https://gabealopez.github.io/index.xml aria-label=rss><span data-feather=rss></span></a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://gabealopez.github.io/><span data-feather=home></span> Home</a></li><li class=nav-item><a href=https://gabealopez.github.io/posts/><span data-feather=book></span> Posts</a></li><li class=nav-item><a href=https://gabealopez.github.io/projects/><span data-feather=code></span> Projects</a></li><li class=nav-item><a href=https://gabealopez.github.io/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://github.com/GabeALopez><span data-feather=github></span></a></li><li class=nav-item><a href=https://gabealopez.github.io/index.xml><span data-feather=rss></span></a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>Heavens Gate</h1><small role=doc-subtitle></small><p class=post-date>2025-07-12</p><ul class=post-tags><li class=post-tag><a href=https://gabealopez.github.io/tags/cybersecurity>Cybersecurity</a></li><li class=post-tag><a href=https://gabealopez.github.io/tags/malware>Malware</a></li></ul></div><div class=post-content><blockquote><p>When Microsoft introduced 64-bit Windows, backward compatibility for 32-bit applications remained essential. This compatibility layer, called WOW64 (Windows-On-Windows 64-bit), allowed older software to function seamlessly. Underneath this compatibility abstraction, however, an opportunity emerged for attackers.</p><p>Security solutions frequently focused their defenses around 32-bit behaviors, neglecting less commonly exploited 64-bit operations. Heaven’s Gate was born from this oversight, enabling threat actors to break free from WOW64’s restrictions and execute unmonitored 64-bit code.</p><p>Named metaphorically after the idea of “ascending” from a restricted environment to a broader, more privileged space, Heaven’s Gate cleverly manipulates processor architecture to achieve stealth.</p><p>Author: Rinzl3r</p><p>Date: April 29, 2025</p><p><a href=https://itinnovationstation.com/2025/04/29/heavens-gate-how-attackers-exploit-architecture-to-evade-detection/>Heaven’s Gate: How Attackers Exploit Architecture to Evade Detection</a></p></blockquote><p>I ended up finding out this interesting mechanic in windows for backwards compatibility and how it can be used in defense evasion.</p><p>The usage of &ldquo;Heaven&rsquo;s Gate&rdquo; as a defense evasion technique is actually quite interesting as one can masquerade their malware</p><p>Imagine making their seemingly 32 bit app, that cannot use modern syscalls, to all of a sudden use 64 bit syscalls</p><p>The article here also gives some hardening and threat hunting techniques as well to look for this type of activity:</p><blockquote><p><em><strong>Threat Hunting Techniques:</strong></em></p><p>Examine WOW64 processes for unusual syscalls.</p><p>Analyze memory sections for mixed-mode instructions.</p><p>Flag processes making 64-bit syscalls without first exiting the WOW64 environment.</p><p>Custom YARA rules targeting unusual syscall gates inside user-mode processes can help uncover hidden threats utilizing this approach.</p><p><em><strong>Hardening Approaches:</strong></em></p><p>Enforce strict application whitelisting.</p><p>Disable WOW64 subsystem where feasible on servers or highly controlled endpoints.</p><p>Apply Kernel-mode code integrity (KMCI) protections.</p><p>Use virtualization-based security (VBS) features like Credential Guard or Hypervisor-enforced Code Integrity (HVCI).</p></blockquote><p>Overall, a very interesting technique and would be interested in implementation in more modern coding languages like zig or go</p><hr><h3 id=some-other-reads-i-found-when-looking-at-this-technique><strong>Some other reads I found when looking at this technique:</strong></h3><p><a href=https://github.com/B4shCr00k/He4vensG4te>Github implementation I found</a></p><p><a href=https://0xk4n3ki.github.io/posts/Heavens-Gate-Technique/>An explanation of Heaven&rsquo;s Gate for a crackme</a></p><p><a href=https://redcanary.com/blog/threat-detection/heavens-gate-technique-on-linux/>Interesting look of Heaven&rsquo;s Gate on Linux</a></p><p><a href=https://www.zdnet.com/article/malware-authors-are-still-abusing-the-heavens-gate-technique/>Article explaining how Heaven&rsquo;s Gate is still being abused to this day, although over 5 years old</a></p></div><div class=prev-next></div><svg id="btt-button" class="arrow-logo" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg><script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script></div></main><footer class=footer><span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer></body></html>